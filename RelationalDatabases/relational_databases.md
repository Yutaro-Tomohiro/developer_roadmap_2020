# Relational Databases

## Database とは何か？

様々なデータを検索や蓄積がしやすいように整理されたデータの集合のことで、一般的にコンピュータで管理されている。

データベースで様々なデータを一元的に管理することで、検索や更新、削除、などの整理が容易かつ整合的に行える。
このような管理はデータベース管理システム(DBMS)で制御することで実現されている。

データベースにはデータを管理するためのモデルが何種類かあり、関係データベース、階層データベース、ネットワークデータベースなどがある。
この中でも現在の主流は関係データベースである。

## Relational Data とは何か？

Relational Database（関係データベース）は、行と列からなる表の形で管理するデータベースのこと。

表、行、列はそれぞれ以下のように呼ぶこともある。

- 表 : テーブル
- 行 : レコード、組、タプル
- 列 : フィールド、属性

# DBMS とは何か？

DataBase Management System のことで、日本語ではデータベース管理システムという。

DB（データベース）は厳密にいうと、データを管理するためのただの箱でしか無いため、実際の制御は他が担わなければならなくて、それを DBMS が担当している。

DBMS の基本的な機能はデータの作成、削除、修正、読み出しなどがある。
それ以外にも誤ったデータの記録の拒否、権限のないユーザーからの不正な利用や改竄を防ぐ機能や一連の操作を矛盾無く実行するトランザクション処理機能、障害時のためにバックアップを作成する復元機能なども備ている。

リレーショナルデータベースの DBMS として世の中で広く使われている有名な製品は

- Oracle Database
- SQLServer
- MySQL
- PostgreSQL

などがある。

## SQL とは何か?

DB を操作するためのプログラミング言語のことで、データの作成や追加、削除、並べ替えなどを行う。
基本的に 1 命令ずつ入力して実行される。

一連の操作をまとめてセットすることのできる「ストアドプロシージャ」という機能を持つ DBMS もある。

DBMS の製品により製品独自の SQL なども存在するため、移植の際には注意が必要。

## MySQL のデータ型について

DB 上でテーブルを作成するときに、カラムに保存するデータのフォーマットに合わせてデータ型を指定でき、カラムごとにあらかじめ 1 つずつ設定しておく必要がある。
カラムには、指定したデータ型に沿ったデータしか保存できない。

データ型を指定することで保存されるデータが整理され、あとから条件を指定して検索したり、同じ体裁でデータを取得することができるメリットがある。

以下から MySQL で利用することができるデータ型と利用方法について書いていく。

### 整数型

整数型は扱える数の範囲が異なる次の 5 つの種類が用意されている。

| データ型  | 範囲                                                                                                    |
| --------- | ------------------------------------------------------------------------------------------------------- |
| TINYINT   | 符号付きの範囲は-128 ~ 127。符号なしの範囲は 0 ~ 255。                                                  |
| SMALLINT  | 符号付きの範囲は-32768 ~ 32767。符号なしの範囲は 0 ~ 65535。                                            |
| MEDIUMINT | 符号付きの範囲は-8388608 ~ 8388607。符号なしの範囲は 0 ~ 16777215。                                     |
| INT       | 符号付きの範囲は-2147483648 ~ 2147483647 。符号なしの範囲は 0 ~ 4294967295。INTEGER とも呼ばれる。      |
| BIGINT    | 符号付きの範囲は-9223372036854775808 ~ 9223372036854775807。符号なしの範囲は 0 ~ 18446744073709551615。 |

また、オプションとして`UNSIGNED`、 `ZEROFILL`、`最大表示幅`がある。

`UNSIGNED`をデータ型の後に付けると 0 と正の数しか格納できなくなる。
このようなデータ型を符号なし整数型という。

`ZEROFILL`をデータ型につけるとデータ型の桁数分 0 で埋められる。
`ZEROFILL`を付けると自動的に`UNSIGNED`がつく。

例えば、`SMALLINT`に`ZEROFILL`をつけて、235 を DB に追加すると DB 上には 00235 で保存される。

整数型のデータ型は最大表示幅を指定することができる。
指定可能な値は 255 まで。
例えば、`INT(5)`というカラムを作成し、235 を DB に追加すると DB 上には 00235 で保存される。

### 浮動小数点数型

浮動小数点数型は扱える数の範囲が異なる次の 2 つの種類が用意されている。

| データ型 | 範囲                                                                                                     |
| -------- | -------------------------------------------------------------------------------------------------------- |
| FLOAT    | -3.402823466E+38 ~ -1.175494351E-38。1.175494351E-38 ~ 3.402823466E+38                                   |
| DOUBLE   | -1.7976931348623157E+308 ~ -2.2250738585072014E-308。2.2250738585072014E-308 ~ 1.7976931348623157E+308。 |

FLOAT 型は単精度浮動小数点数でおおよそ小数第 7 位まで正確。
また、DOUBLE 型は倍精度小数点数でおおよそ小数第 15 位まで正確。

FLOAT 型と DOUBLE 型は桁数の合計と小数点以下の桁数を以下のような書式で指定することができる。

```
FLOAT(桁数の合計, 小数点以下の桁数)
DOUBLE(桁数の合計, 小数点以下の桁数)
```

例えば、`DOUBLE(6,4)`のカラムを作成する。
このカラムには、小数点以下の桁数が 4 で全体の桁数が 6 の数字が保存できる。

12.3 という数字を追加して DB を確認すると、12.3000 という数字が保存されている。

小数点以下が指定した桁数より多い場合、指定した桁数以下の部分で四捨五入した値が保存される。
例えば、12.34567 という数字は 12.3457 となって保存される。

また、整数型と同じように`UNSIGNED`と `ZEROFILL`が使える。

### 固定小数点数型

固定小数点数型は`DECIMAL`というデータ型が用意されている。

`DECIMAL[(M[,D])] [UNSIGNED] [ZEROFILL]`という感じで使う。

M は桁数の合計(精度)で D は小数点以下の桁数(スケール)。
最大桁数(M)は 65。
デフォルトは 10。

小数部の最大桁数(D)は 30。
デフォルトは 0。

また、`NUMERIC`と呼ばれたりする。

DECIMAL 型は正確なデータを格納するので、金銭データなど正確な精度を保持することが重要な場合に適している。

例えば、`DECIMAL(5, 2)`とした場合、小数点以下が 2 桁、全体で 5 桁の数値を格納することができるので、-999.99~999.99 の範囲の値が格納できる。

### BIT 型

BIT 型はビット値を格納するために使われるデータ型で以下のように使う。

`BIT(M)`

M 保存できるビット数。
M は 1~64。

MySQL でビット値を記述する場合、以下のように書く。

```
b'0111'
B'0111'
0b0111
```

### 日付型と時刻型

日付型と時刻型のデータ型として以下の 5 つが用意されている。

| データ型  | 特徴                                                                                                                                               |
| --------- | -------------------------------------------------------------------------------------------------------------------------------------------------- |
| DATE      | 日付。範囲は 1000-01-01~9999-12-31。フォーマット：`YYYY-MM-DD`                                                                                     |
| DATETIME  | 日付と時間の組み合わせ。範囲は 1000-01-01 00:00:00.000000~9999-12-31 23:59:59.999999。フォーマット：`YYYY-MM-DD HH:MM:SS[.fraction]`               |
| TIMESTAMP | タイムスタンプ。TIMESTAMP。値はエポック(1970-01-01 00:00:00 UTC)からの秒数。範囲は 1970-01-01 00:00:01.000000 UTC~2038-01-19 03:14:07.999999 UTC。 |
| TIME      | TIMESTAMP 値は、エポック(1970-01-01 00:00:00 UTC)からの秒数。1970-01-01 00:00:01.000000 UTC から 2038-01-19 03:14:07.999999 UTC                    |
| YEAR      | ２桁または４桁の形式の年。４桁の形式では 1901 ~ 2155, 0000。２桁の形式では 70 ~ 69(1970 ~ 2069 に相当)。フォーマット : YYYY または YY              |

### CHAR 型と VARCHAR 型

文字列型の CHAR 型の構文は以下の通り。

```
CHAR[(M)] [CHARACTER SET 文字セット] [COLLATE 照合順序]
```

CHAR 型は固定長文字列のこと。
M は文字数であり、M の範囲は 0 ~ 255。
省略する場合、長さは 1 になる。
格納時には指定された長さになるように右側がスペースで埋められる。
ただし、値を取得するときは末尾にある空白は全て削除される。
比較の時も同様。

VARCHAR 型の特徴は以下の通り。

```
VARCHAR(M) [CHARACTER SET 文字セット] [COLLATE 照合順序]
```

可変長文字列のことで、M は最大文字数を表す。
M の範囲は 0 ~ 65535。
ただし、使用する文字コードのバイト数による。
バージョンによっては、末尾に入れた空白がそのまま格納される。
取得されるときは空白付きだが、WHERE 句で比較するときは末尾の空白は削除される。

### BINARY 型と VARBINARY 型

文字列型の BINARY 型の特徴は以下の通り。

```
BINARY(M)
```

固定長バイナリバイト文字列のことで、M はバイト数を表す。
M の範囲は 0 ~ 255。
格納時指定された長さになるように右側が 0x00 で埋められる。
取得時も 0x00 は削除されない。

VARBINARY 型の特徴は以下の通り。

```
VARBINARY(M)
```

可変長バイナリバイト文字列のことで、M は最大バイト数。
M の範囲は 0 ~ 65535。
BINARY 型とは違い、末尾に 0x00 はつかない。
空白と 0x00 は異なるため、データ末尾に空白があった場合はそもままバイナリデータとして格納される。

### BLOB 型と TEXT 型

BLOB 型と TEXT 型は巨大なバイナリデータとテキストデータを格納するときに利用される。

BLOB 型はバイナリデータを扱うデータ型で格納するデータのサイズを指定しない。
画像ファイルなどを格納するときに使われる。
最大長は決まっていて、最大長の種類によって 4 つ用意されている。

| 種類       | 最大長                                                   |
| ---------- | -------------------------------------------------------- |
| TINYBLOB   | 最大長が 255 バイト。                                    |
| BLOB[(M)]  | 最大長が 65535 バイト。オプションの長さ M を指定できる。 |
| MEDIUMBLOB | 最大長が 16777215 バイト。                               |
| LONGBLOB   | 最大長が 4294967295 または 4G バイト。                   |

BLOB 型は VARBINARY 型で格納できるバイト数を指定しないものと考えれば OK。
データはバイナリデータとして格納される。

TEXT 型は文字列データを扱うデータ型で格納するデータのサイズを指定しない。
最大長は決まっていて、その種類によって 4 つ用意されている。
ただし、各データ型は値にマルチバイト文字が含まれる場合、有効な最大長は少なくなる。

| 種類                               | 特徴                                                           |
| ---------------------------------- | -------------------------------------------------------------- |
| TINYTEXT[CHARACTER SET][collate]   | 値にマルチバイト文字が含まれる場合、有効な最大長は少なくなる。 |
| TEXT[(M)][character set][COLLATE]  | 最大長が 65535 文字。オプションの長さ M を指定できる。         |
| MEDIUMTEXT[CHARACTER SET][collate] | 最大長が 16777215 文字。                                       |
| LONGTEXT[CHARACTER SETe][collate]  | 最大長が 4294967295 または 4G 文字。                           |

TEXT 型は VARCHAR 型で格納できるバイト数を指定しなかったものと考えれば OK。
データは文字列データとして格納される。

### ENUM 型

文字列型の ENUM 　型の使い方は以下の通り。

```
ENUM('value1','value2',...)[CHARACTER SET][COLLATE]
```

- リストから選択された値を 1 つだけ持つ。
- ENUM 値は内部では整数として表される。
- ENUM カラムは最大 65535 個の個別の要素を含めることができる。

ENUM 型は予め扱いたい文字列を指定しておいて、DB 内部ではその文字列に対応する整数値で管理できる型のこと。

例えば、文字列の値として、`('red', 'blue', 'green')`を扱うとき、DB では`(1, 2, 3)`では管理されている(インデックスは 1 から割り振られる)。

### SET 型

SET 型の使い方は以下の通り。

```
SET('value1','value2',...)[CHARACTER SET][COLLATE]
```

SET 型はカラムに対して、引数に取った値を「複数のデータ」として格納できるデータ型。

例えば、データを定義するときに`color`という名前のカラムを SET 型として、引数に`('red', 'blue', 'green')`と引数を指定することができる。

SET 型には以下のような特徴がある。

- SET に定義していないデータを格納しようとしても、レコードにデータは格納されない
- SET で定義したデータは、カンマ区切りで複数のデータを格納できる
- SET で並べた順番でデータが定義されるため、SET 時に並べた順番は無視される
- SET で並べたデータは、前から順にインデックス番号が`2のn乗`で付与される
- 最大で 64 個のメンバーを格納可能

SET 型と ENUM 型の違いは

- SET 型 : リストの中から選ぶ
- ENUM 型 : リストの中から一つ選ぶ

## 参考文献

ProEngineer | そもそもデータベースとは？基礎から分かるデータベース入門(最終閲覧日：2020 年 11 月 2 日）
https://proengineer.internous.co.jp/content/columnfeature/6411#section104

Oracle Japan | データベースとは(最終閲覧日：2020 年 11 月 2 日）
https://www.oracle.com/jp/database/what-is-database.html

MySQL | 第 11 章データ型(最終閲覧日：2020 年 11 月 2 日）
https://dev.mysql.com/doc/refman/8.0/en/data-types.html

DBOnline | MySQL のデータ型(最終閲覧日：2020 年 11 月 2 日）
https://www.dbonline.jp/mysql/type/

Qiita | MySQL の set 型について理解する。インデックス番号を付与して複数データを定義しよう(最終閲覧日：2020 年 11 月 9 日）
https://qiita.com/bitcoinjpnnet/items/e8216678070d93ff37ac
