# Transactions

## トランザクションとは

トランザクションとは**分離させることのできない複数の処理を 1 つにまとめたもの**のこと。

例えば、口座振り込みで以下の 2 つの処理があったとする。

1. A さんの口座から 5,000 円分差し引き、残高 10,000 - 5,000 = 5,000 円にする
2. B さんの口座へ 5,000 円分プラスし、残高 20,000 + 5,000 = 25,000 円にする

ここでこれらの処理を分離して、それぞれ独立した処理にしたと考える。

この時、１の処理が上手くいって、２の処理が失敗した場合、A さんの口座残高は 5,000 円になっているいる一方で、B さんの口座残高は 20,000 円のままで、5000 円が**消失**してしまうことになる。

このようなことを防ぐために 1, 2 をまとめて１つの処理にする。

こうすることで、どちらがか失敗しても、1 つの処理として失敗したことになり、処理をしていない状態に戻すことができる。

処理をしていない状態に戻す処理のことを**ロールバック**という。

トランザクションはこのような特性から、結果の整合性が要求される処理に適した技法である。

## SQL におけるトランザクションの実装方法

とりあえず構文を下に示す。

```
START TRANSACTION;

一連の処理

COMMIT;
(もしくはROLLBACK)

```

MySQL でトランザクションを実装するには`START TRANSACTION`と`COMMIT`もしくは`ROLLBACK`で処理を挟めば良い。

`START TRANSACTION`を使うことで自動コミットが無効になる。

Auto Increment を指定しているレコードに対してロールバックを行った場合、数値の加算だけは実行されるので注意。

## FW におけるトランザクションの実装方法

## 参考文献

MySQL | START TRANSACTION, COMMIT, and ROLLBACK Statements(最終閲覧日：2020 年 12 月 7 日）
https://dev.mysql.com/doc/refman/8.0/en/commit.html

Qiita | データベースさわったこと無い新人向けトランザクション入門(最終閲覧日：2020 年 12 月 7 日）
https://qiita.com/komattio/items/838ea5df68eb076e8099
